# Project Systematisator 2.0 — Методология

> Полное руководство по организации проектов для работы с AI-ассистентами.
> Обновлено: 2026-01-19

---

## Проблема

AI-ассистенты тратят токены на:
1. **Разведку** — поиск где что лежит
2. **Устаревший контекст** — знания из training data
3. **Повторение** — каждая сессия с нуля
4. **Перегруз** — загружают всё подряд вместо нужного

---

## Решение: 4 слоя системы

```
┌─────────────────────────────────────────────────────────────┐
│  СЛОЙ 1: НАВИГАЦИЯ                                          │
│  CLAUDE.md — компактный роутинг                             │
│  "When to Read" — когда какой модуль читать                 │
└─────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│  СЛОЙ 2: МОДУЛЬНЫЕ ПРАВИЛА                                  │
│  .agents/reference/ — on-demand контекст                    │
│  Загружается только нужный модуль                           │
└─────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│  СЛОЙ 3: ФИЛОСОФИЯ                                          │
│  .claude/project.skills.md — бизнес-контекст                │
│  Стек, архитектурные решения, что НЕ делать                 │
└─────────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────────┐
│  СЛОЙ 4: АВТОМАТИЗАЦИЯ                                      │
│  MCP серверы — внешние данные                               │
│  Hooks — автоматические действия                            │
└─────────────────────────────────────────────────────────────┘
```

---

## Слой 1: CLAUDE.md (Навигация)

### Принципы
- **Компактный** — максимум 50-60 строк
- **Роутинг** — таблица "Document | When to Read"
- **Без номеров строк** — они устаревают мгновенно
- **Ссылки на модули** — не дублировать контент

### Структура

```markdown
# ProjectName — Навигация

> **Модульные правила:** `.agents/AGENTS.md`
> **Философия проекта:** `.claude/project.skills.md`

## Reference Documentation

Read these documents when working on specific areas:

| Document | When to Read |
|----------|--------------|
| [commands.md](.agents/reference/commands.md) | Adding bot commands |
| [payments.md](.agents/reference/payments.md) | Payment processing |
| [database.md](.agents/reference/database.md) | DB models, queries |

**Load only what you need** — keep context lean.

## Структура проекта

[Дерево файлов с размерами]

## Стек

[Краткий список технологий]

## Деплой

[Одна команда]
```

---

## Слой 2: Модульные правила (.agents/)

### Структура

```
.agents/
├── AGENTS.md              # Главный файл (список модулей)
└── reference/
    ├── commands.md        # Команды
    ├── callbacks.md       # Callbacks
    ├── payments.md        # Платежи
    ├── database.md        # БД
    └── admin.md           # Админка
```

### AGENTS.md

```markdown
# ProjectName — Modular Rules

> Загружай только нужный модуль по контексту задачи.

## Модули (on-demand context)

| Задача | Модуль | Что внутри |
|--------|--------|------------|
| Команды | commands.md | cmd_* функции |
| Платежи | payments.md | V3, Bitget |
| БД | database.md | Модели, функции |

## Как использовать

Работаешь над X? → Читай только X.md
Не загружай всё подряд — контекст должен быть lean.
```

### Шаблон модуля

```markdown
# Название модуля

> Модуль: краткое описание
> Файл: `путь/к/файлу.py`

## Функции/Классы

| Название | Что делает |
|----------|------------|
| func1 | Описание |
| func2 | Описание |

## Как найти

\`\`\`bash
grep -n "pattern" file.py
\`\`\`

## Паттерн кода

\`\`\`python
# Пример использования
\`\`\`

## Важно

- Правило 1
- Правило 2
```

---

## Слой 3: Философия (.claude/project.skills.md)

### Что включать

1. **Философия продукта** — что это, для кого
2. **Технический стек** — версии важны (aiogram 3.x, не 2.x!)
3. **Бизнес-правила** — типы юзеров, цены
4. **Архитектурные решения** — почему так сделано
5. **Закиды из обсуждений** — история решений
6. **Что НЕ делать** — защита от поломки

### Шаблон

```markdown
# ProjectName — Project Skills

> Философия и специфика проекта. Живой документ.

## Философия продукта

### Главная идея
[Что это за проект]

### Целевая аудитория
[Для кого]

## Технический стек

| Компонент | Технология | Версия |
|-----------|------------|--------|
| Язык | Python | 3.11+ |
| Фреймворк | aiogram | **3.x** |

## Бизнес-правила

[Ключевые правила]

## Архитектурные решения

### Почему X?
[Объяснение]

## Закиды из обсуждений

### YYYY-MM-DD: Тема
- Решение 1
- Решение 2

## Что НЕ делать

1. Не ломать X
2. Не менять Y
```

---

## Слой 4: Автоматизация

### MCP серверы

| MCP | Что даёт | Установка |
|-----|----------|-----------|
| Memory | Память между сессиями | `claude mcp add memory -- npx -y @modelcontextprotocol/server-memory` |
| PostgreSQL | SQL запросы напрямую | `claude mcp add postgres -- npx -y @modelcontextprotocol/server-postgres "connection_string"` |
| Context7 | Актуальная документация | `claude mcp add context7 -- npx -y @upstash/context7-mcp` |

### Hooks (.claude/settings.json)

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit|Write|Read",
        "hooks": [{
          "type": "command",
          "command": "защита .env файлов"
        }]
      }
    ],
    "Stop": [
      {
        "matcher": "",
        "hooks": [{
          "type": "command",
          "command": "уведомление при завершении"
        }]
      }
    ]
  }
}
```

---

## Полная структура проекта

```
PROJECT/
├── CLAUDE.md                    # Навигация (компактный)
├── .claude/
│   ├── project.skills.md        # Философия
│   ├── settings.json            # Hooks
│   └── settings.local.json      # Permissions (не в git)
├── .agents/
│   ├── AGENTS.md                # Список модулей
│   └── reference/
│       ├── commands.md
│       ├── payments.md
│       ├── database.md
│       └── admin.md
├── .mcp.json                    # MCP серверы (project scope)
└── docs/                        # Документация для людей
```

---

## Что читает Claude автоматически

| Файл | Читает? |
|------|---------|
| `CLAUDE.md` | ✅ Да, при старте |
| `.claude/project.skills.md` | ✅ Да, при старте |
| `.claude/settings.json` | ✅ Да, загружает hooks |
| `.agents/reference/*.md` | ❌ Только по запросу |
| `docs/*.md` | ❌ Только по запросу |

---

## Экономия токенов

### Было (v1.0)

```
CLAUDE.md: 175 строк (~1800 токенов)
project.skills.md: ~1300 токенов
Итого при старте: ~3100 токенов
```

### Стало (v2.0)

```
CLAUDE.md: 53 строки (~500 токенов)
project.skills.md: ~1300 токенов
Итого при старте: ~1800 токенов
+ модуль по требованию: ~500 токенов
```

**Экономия: ~800 токенов на сессию**

---

## Чеклист нового проекта

```bash
# 1. Создать структуру
mkdir -p .claude .agents/reference

# 2. Создать CLAUDE.md (компактный, с роутингом)

# 3. Создать .claude/project.skills.md (философия)

# 4. Создать модули в .agents/reference/

# 5. Добавить MCP (опционально)
claude mcp add memory -- npx -y @modelcontextprotocol/server-memory

# 6. Настроить hooks через /hooks
```

---

## Ключевые принципы

1. **Модульность** — загружай только нужное
2. **Без номеров строк** — используй grep паттерны
3. **Компактный CLAUDE.md** — роутинг, не контент
4. **Философия отдельно** — project.skills.md
5. **Автоматизация** — MCP + Hooks

---

## Отличия от v1.0

| Аспект | v1.0 | v2.0 |
|--------|------|------|
| CLAUDE.md | Большой, всё в одном | Компактный, роутинг |
| Модули | Нет | .agents/reference/ |
| Номера строк | Да (устаревают) | Нет (grep паттерны) |
| MCP | Не использовались | Memory, PostgreSQL |
| Hooks | Нет | Защита файлов, уведомления |
| "When to Read" | Нет | Явная колонка |

---

*Версия 2.0 | 2026-01-19*
*Автор: Руслан Лама + Claude Code*
